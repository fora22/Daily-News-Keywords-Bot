# Daily News Keywords Bot
## 프로젝트 배경
실시간 검색어가 사라진 후로 그날그날 중요 키워드를 확인하기가 어렵다.
최근에는 시간상 뉴스를 매일 챙겨보는 것도 어려워졌다. 
그렇다면 뉴스에 자주 등장하는 키워드들을 추출해서 메신저로 알림을 보내주는 서비스를 개발 어떨까?

---

## 데이터 파이프라인
![Daily-Keywords-Bot](https://user-images.githubusercontent.com/54028026/135100050-1a99aae9-1199-4c5f-8747-0822ce464cb9.png)

---
기술 스택을 활용하는 이유에 관해
- 몽고디비: 가장 익숙한 오픈 소스 NoSQL 디비이면서 사용하기 쉽다. 몽고 익스프레스를 활용하며 웹 기반으로 관리가 가능한 것도 장점이다. 도큐먼트를 대표하는 키를 인덱스를 생성할 경우 쿼리로 탐색도 빠른편이다. 유니크 인덱스의 경우 O(logN) 정도의 시간복잡도라고 한다.
- 엘라스틱 서치: 도큐먼트 하나에 명사들을 배열로 저장했을 때 키바나로 시각화하기 쉽다. 다중 필드 조건으로 쿼리를 날려서 가공한 데이터를 처리하기에도 좋다.
- 에어플로우: 메인 랭귀지가 파이썬이며 해당 프로젝트는 배치 처리이며 각각의 컴포넌트들이 의존성을 가지므로 에어플로우가 스케줄링 툴로 적합하다.

---
### 컴포넌트 역할 요약
1. 크롤러 - 뉴스 데이터 수집 및 저장
2. 프로듀서 - 수집한 뉴스 데이터를 데이터 웨어하우스에 저장
3. 데이터 웨어하우스 - 몽고디비의 컬렉션을 날짜로 생성하여 뉴스 데이터를 저장
4. 컨슈머(명사 추출) - 데이터 웨어하우스에 저장한 뉴스 데이터의 명사를 추출하여 엘라스틱 서치에 저장
5. 데이터 마트 - 가공한 날짜, 포털, 카테고리, 세부 카테고리, 명사 리스트 데이터를 저장
6. 시각화 - 키바나를 활용하여 엘라스틱 서치의 인덱스를 시각화
7. 슬랙 봇 - 엘라스틱 서치에 오늘 날짜를 기준으로 쿼리를 날려서 포털 및 세부 뉴스 별로 명사 카운팅 후 메세지 발송



## 데이터 수집 & 변환
- Extract - 2대의 크롤러는 각각 네이버, 다음 뉴스 서비스에서 오늘 날짜에 해당하는 뉴스 기사를 모두 수집한 뒤 텍스트 파일 형태로 저장합니다.
- Producer - 프로듀서는 레코드를 bson 형태로 변환합니다. 해당 과정에서 스키마에 문제가 있을 경우 fail 항목에 추가하여 수동으로 후처리가 가능합니다.
[이미지]


---

## 데이터 웨어하우스
수집하는 데이터는 뉴스 기사 데이터로 날짜라는 시간적 속성을 가지고, 기사 한 건이 도큐먼트라는 점입니다. 이와 같은 이유로 몽고 디비를 데이터 웨어하우스 용도로 활용했습니다.
초반에는 하둡을 사용하기 위해 Hbase를 고려했으나 데이터 마트는 OLTP라는 점, 그리고 데이터의 특성을 고려했을 때 몽고 디비가 더욱 적합하다고 판단했습니다.

데이터 관리에서의 이점을 위해 DB - News, Collections - date 형태로 관리합니다.


<img width="450" alt="몽고디비_데이터웨어하우스" src="https://user-images.githubusercontent.com/54028026/140483802-9574571c-0c97-46b2-bf00-f9b069a08d62.png"> <img width="450" alt="몽고디비_컬렉션" src="https://user-images.githubusercontent.com/54028026/140483822-c1639c10-f188-4f62-a547-98a5ff9a82b1.png">
---

## 데이터 마트 & 가공
명사 추출기는 konlpy의 okt를 활용했습니다.
데이터 웨어하우스에 오늘 날짜에 해당하는 데이터를 요청한 뒤, 뉴스 제목에서 명사만을 추출하여 배열로 변환하고, 엘라스틱 서치에 적재합니다.


<img width="1427" alt="엘라스틱서치_데이터마트" src="https://user-images.githubusercontent.com/54028026/140483831-85de6cd5-3e07-4461-82cd-489b19a94211.png">


---

## 시각화 대시보드
키바나를 활용하여 가공한 데이터를 손 쉽게 시각화할 수 있습니다.

<img width="1440" alt="키바나_대시보드" src="https://user-images.githubusercontent.com/54028026/140483828-86e652f1-fa26-4968-8e64-f2a180356c5c.png">


---

## 알림 봇
데이터 가공이 마무리된 후 집계 작업을 실시하여 각 포털의 세부 섹션 별로 자주 등장하는 키워드를 카운팅하여 알림 메세지를 전송합니다.

<img width="1431" alt="슬랙봇" src="https://user-images.githubusercontent.com/54028026/140484490-ea5d3aeb-c9de-4271-8498-18d6075ae08e.png">



---

## 스케줄링
배치 스케줄링을 위해 에어플로우를 활용합니다. 크론으로도 충분히 가능한 작업이므로 초기에는 도입을 고려했지만, 학습 목적으로 활용했습니다.
가장 기초적인 BashOperator를 사용합니다.

<img width="1419" alt="에어플로우_스케줄링" src="https://user-images.githubusercontent.com/54028026/140483817-e8d45818-3b6e-4d40-8366-8b1521ae6d74.png">

---

